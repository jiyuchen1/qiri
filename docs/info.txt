## 1

基于“七日世界”设定：收容物类似战宠，拥有从全体技能中抽取的技能池，不同收容物的技能池存在重合。请设计并实现一个可交互的“收容物—技能”关系拓扑可视化界面，用于直观展示映射与重叠关系，并支持探索与分析。

目标
- 直观呈现收容物与技能的双部图关系（Bipartite Graph），突出技能池重合与热门技能。
- 支持检索、筛选、高亮、对比与导出，便于策划与玩家理解技能生态。
- 在中小规模（数百节点、数千边）下保持流畅交互，具备扩展空间。

输入数据与数据模型
- 输入为 JSON，包含两类节点与边：
  - 收容物对象: { id, name, rarity, faction?, tags?, skills: [skillId...] }
  - 技能对象: { id, name, category, type, rarity?, tags? }
  - 可选统计/权重: { unlockLevel?, cost?, power?, synergyTags? }
- 要求：
  - 提供一份示例数据集（≥10 个收容物，≥25 个技能），刻意制造技能重合（如多个收容物共用核心技能）。
  - 数据与界面解耦：提供 loadData(json) 更新方法；允许外部动态替换数据。

可视化设计
- 图模型：
  - 双部图：左侧为收容物节点，右侧为技能节点；边表示“收容物拥有该技能”。
  - 支持布局切换：分层双列布局、力导向布局、以及按技能类别分组布局（Group/Cluster）。
- 编码映射：
  - 节点形状/颜色区分类型（收容物 vs 技能）。
  - 颜色/图标编码：收容物按稀有度，技能按类别；提供图例。
  - 节点大小：技能节点按被引用次数（度）大小映射，以凸显“热门技能”；收容物可按战力/稀有度映射。
  - 边样式：可按权重/稀有度调整粗细与透明度；缩放较小时隐藏标签与弱边（LOD）。
- 重合表达：
  - “热门技能”高亮：被多个收容物引用的技能节点以热度色阶/发光描边呈现。
  - “收容物相似度”模式：基于技能集合 Jaccard 相似度计算收容物两两相似，阈值以上显示虚线边或在侧栏列出 Top N 对（不与主图混乱冲突，默认隐藏，可切换）。
  - 技能类别分区：使用分区背景或包围轮廓表示技能类别群。

交互与功能
- 基础交互：
  - 悬停显示 Tooltip（名称、类型、稀有度、技能列表/被引用次数等）。
  - 点击节点聚焦：高亮相邻边与相邻节点，淡化其他；侧栏展示详情（属性、标签、关联列表、统计）。
  - 框选/多选：支持对多个收容物或技能进行对比；侧栏展示交集/并集技能与差异。
- 检索与筛选：
  - 关键字搜索（模糊匹配名称/标签）。
  - 筛选条件：收容物稀有度、标签；技能类别、类型、稀有度；引用次数范围；仅显示有重合的元素。
  - 一键高亮“高重合收容物”“高热度技能”。
- 视图控件：
  - 布局切换（双部/力导向/分组）、重置视图、缩放/平移、节点固定/解锁、迷你地图（可选）。
  - 标签开关与密度控制；拥挤时自动隐藏次要标签。
- 分析与统计（侧栏/顶部面板）：
  - 技能热度榜（按被引用次数降序）。
  - 收容物相似度对（Top N，点击可临时只显示两者与其技能交并集）。
  - 全局指标：节点/边计数、平均度、最大度、重合分布直方图。
- 导入与导出：
  - 导入 JSON 更新图。
  - 导出当前视图为 PNG/SVG；导出选中子图为 JSON。

性能与可扩展性
- 规模目标：约 200–500 收容物、150–400 技能、最多 5k–15k 边。
- 优化策略：
  - 优先使用 WebGL 支持的图可视化库（如 Cytoscape.js + cytoscape-cola/avsdf、Sigma.js、ECharts Graph GL）。
  - 渐进渲染、按缩放等级隐藏边/标签、边汇聚/抽样、高开销计算（相似度）在 Web Worker 中执行。
  - 缓存度数与相似度结果；交互时增量更新。
- 可扩展方向：
  - 技能协同（synergy）推断与可视化；社区检测；时间维度（版本变更）对比；分布式数据源。

技术要求
- 提供可本地直接运行的网页实现（HTML/CSS/JS），不依赖后端；使用常见前端图可视化库之一：
  - 推荐：Cytoscape.js 或 ECharts（含布局与 WebGL 支持）；如选 D3，请补充性能策略。
- 代码需模块化与注释清晰，包含：
  - 数据加载与校验、图构建与更新、布局控制、交互逻辑、筛选与搜索、统计计算、导出功能。
  - 样式主题（深/浅色切换可选）、响应式布局（桌面与 1366×768 适配）。

交付物
- 运行说明：如何本地打开、如何替换数据。
- 示例数据 JSON（含注释说明字段含义）。
- 完整可运行示例代码（单文件或少量文件），并说明如何扩展为组件化结构（如使用框架时提供简要目录与初始化代码）。
- 设计说明：图模型选择理由、编码映射、布局取舍、性能策略概述。

请直接输出：
1) 概要设计说明（简洁）；
2) 示例数据 JSON；
3) 可直接运行的前端代码（含注释）；
4) 使用与自定义指南；
5) 可选的扩展建议与替代技术栈说明。

## 2

阅读并理解以下项目文件，先输出你对现状的精准总结（数据结构、页面功能、脚手架/运行方式、任何现有的“收容物/技能”相关字段），再在不破坏现有功能的前提下，基于现有代码与数据结构实现以下增量能力：
@/info.txt
@/README.md
@/data.json
@/index.html
@/large_data.json
@/QWEN.md

目标
- 在现有项目基础上新增“收容物”和“技能”的增删改查功能
- 维护“收容物”和“技能”的多对多关联关系：创建关联、取消关联、查看关联、批量导入/导出关联
- 仅要求的核心字段：收容物名称、技能名称；允许可选扩展字段，但必须保证不引入破坏性变更
- 对大数据文件的友好支持（large_data.json）：按需加载、去重、搜索、分页/虚拟滚动

约束与兼容性
- 保持向后兼容：不改变现有字段语义，不移除现有功能，不改动对外可见行为除非明确说明
- 若现有数据结构已包含类似概念，需复用并做非破坏性扩展（版本化字段或新增命名空间）
- 纯前端实现优先（index.html + 原生 JS/CSS），不引入重型依赖；如需构建/脚本，提供可选 Node 脚本且不强制依赖
- 国际化排序与去重使用中文优先的 localeCompare('zh-CN')，名称对比需大小写与全角半角不敏感，去除前后空白并做 Unicode 规范化

数据模型设计（请结合现有 data.json/large_data.json 实际结构，做最小侵入式落地）
- 收容物 ContainmentItem
  - 必填：id、name
  - 选填（可选扩展）：alias、description、tags、createdAt、updatedAt
- 技能 Skill
  - 必填：id、name
  - 选填同上
- 关联 EntitySkillLink（多对多）
  - 必填：id、entityId、skillId
  - 唯一性：同一对 entityId+skillId 只能存在一条关联
说明：
- id 生成策略：基于名称的规范化 slug（去空白、全角半角归一、转小写、移除不安全字符）+ 碰撞时追加短随机后缀；确保可复算且稳定
- 持久化格式：在 data.json 内新增或扩展顶层命名空间，如 items、skills、links；若现有 schema 冲突，采用嵌套命名空间 extensions.containment 以避免破坏
- large_data.json 作为可选的大数据源：读取合并时做去重与映射，不直接覆盖 data.json

功能清单
- 收容物管理
  - 创建：输入名称，唯一性校验，生成 id，写入 data.json 或本地存储，支持批量导入（换行/CSV/JSON）
  - 更新：修改名称（保持唯一）、可选扩展字段更新、更新时间戳
  - 删除：支持软删除或硬删除二选一；若硬删除需自动清理关联
  - 查询：按名称搜索、排序、分页/虚拟滚动
- 技能管理：与收容物管理对称
- 关联管理
  - 创建关联：在收容物详情页选择技能，多选勾选即建立 links 记录；或在技能详情页选择收容物
  - 取消关联：从任一侧解除即删除对应 links
  - 查看关联：在列表与详情中显示计数与清单，支持过滤/搜索/导出
  - 批量导入/导出：支持 CSV（entityName,skillName）与 JSON（links 数组），自动补全缺失的实体或技能
- 数据导入导出
  - data.json 的导入导出按钮；合并策略可选：仅新增、覆盖同名、跳过冲突并出报告
- 大数据优化
  - large_data.json 懒加载；列表使用虚拟滚动；搜索采用简单索引（前缀/子串），避免全量遍历
- 校验与冲突处理
  - 名称唯一与规范化比对；检测相似项（编辑距离/同音可选）并提示合并
  - 删除时若存在关联：确认对话框；可选择同时删除关联或阻止删除
- 可访问性与可用性
  - 键盘导航、ARIA 属性、明确的错误提示与成功反馈
  - 本地缓存未保存变更的提示；导出的文件名包含时间戳

UI 变更（在 index.html 内实现）
- 新增三个模块：收容物管理、技能管理、关联管理
  - 每个模块包含：搜索框、创建表单、列表（名称、关联计数、操作）、分页/虚拟滚动
  - 详情抽屉/对话框：展示基本信息与关联编辑器（双列表选择或多选下拉）
  - 导入导出入口、去重/合并工具、冲突报告区域
- 保持现有样式风格与结构，避免破坏既有布局；仅用原生 CSS/少量内联样式

持久化策略与实现
- 首选方案：在前端内存态维护变更，提供“保存到本地文件”导出；“从文件导入”合并。适用于纯静态托管
- 可选方案：提供一个 Node 脚本（scripts/update-data.mjs），支持从标准输入读入变更并写回 data.json，包含冲突检测与备份 data.json.bak
- 数据写入具备原子性：先写临时文件再替换；保留最近 N 个备份

错误处理与日志
- 统一错误边界，用户可见错误消息与控制台详细日志
- 校验错误提供可修复建议，批量操作给出逐条结果与汇总

迁移与兼容
- 若现有 data.json 已含相关结构：输出对比与迁移计划；提供一次性迁移脚本或步骤
- 保留旧字段与行为，新增字段标注 version；README 中记录变更说明与回滚方法

输出要求（一次性给全量可运行变更）
- 先输出对现有项目的结构与数据格式总结（精炼、准确）
- 给出最终的数据结构定义与示例片段（基于实际文件落地）
- 以统一 diff 形式给出对以下文件的修改与新增：
  - 修改：@/index.html、@/README.md、@/data.json（如需初始化结构）、@/QWEN.md（如需补充使用说明）
  - 新增（如需）：@/scripts/update-data.mjs、@/scripts/migrate.mjs、@/assets/styles.css 或内联样式优化
- 在 index.html 中内联或以 <script> 引入新增的 JS 逻辑，纯原生实现；对每个核心函数附简要注释
- 提供使用文档：如何添加/编辑/删除收容物与技能、创建/取消关联、导入导出、冲突处理
- 提供测试清单与用例数据：小规模与 large_data.json 场景；覆盖边界条件（重名、超长名、非法字符、孤儿关联、批量导入混合成功/失败）
- 说明性能与复杂度评估，给出在 1万/10万 规模下的预期表现与降级策略

验收标准
- 能在本地直接打开 index.html 即使用新增功能（无构建步骤），或提供可选脚本的简单运行方式与命令
- 能创建、编辑、删除收容物与技能，且名称唯一规则正确生效
- 能建立和解除多对多关联，UI 中正确显示关联计数与清单
- 导入导出功能可用，冲突检测与报告清晰，数据不会丢失或破坏原有字段
- 在加载 large_data.json 时交互流畅，搜索与分页可用，不阻塞主线程
- 所有变更均有文档说明，且与现有功能兼容无回归

请全程使用中文输出，遵循上述输出要求与顺序，确保内容可直接复制应用，避免含糊表述与占位符。